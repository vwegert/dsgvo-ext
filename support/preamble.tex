%!TEX root = ../DSGVO-ExtendedVersion.tex

% ---------------------------------------------------------------------------------------------------------------------
% Dokumentenklasse
\documentclass[
  oneside,
  a4paper,
  10pt,
  DIV=14,
  parskip=half,
  numbers=noenddot,
  chapterprefix=false,
  headings=small,
  bibliography=notnumbered%,
  %mpinclude=true
]{scrbook}


% ---------------------------------------------------------------------------------------------------------------------
% Layout
%\usepackage{showframe}
\usepackage{scrlayer-scrpage} 
\usepackage{scrlayer-notecolumn}
\newlength{\paragraphscolwidth} 
\AfterCalculatingTypearea{%
  \setlength{\paragraphscolwidth}{% 
    .333\textwidth}%
  \addtolength{\paragraphscolwidth}{% 
    -\marginparsep}%
}
\recalctypearea 
\DeclareNewNoteColumn[%
  position=\oddsidemargin + 1in + .667\textwidth + \marginparsep,
  width=\paragraphscolwidth, 
  font=\raggedright\footnotesize\color{red} 
]{paragraphs}

% ---------------------------------------------------------------------------------------------------------------------
% Makro-Hilfen
\usepackage{xspace}
\xspaceaddexceptions{"=}
% see https://tex.stackexchange.com/questions/652100/dimeval-for-pdflate
\ExplSyntaxOn
\cs_if_exist:NF \dimeval { \cs_set_eq:NN \dimeval \dim_eval:n }
\ExplSyntaxOff


% ---------------------------------------------------------------------------------------------------------------------
% Eingabekodierung
\usepackage[utf8]{inputenc}
\usepackage[T1]{fontenc}


% ---------------------------------------------------------------------------------------------------------------------
% Spracheinstellungen
\usepackage[ngerman]{babel}
\usepackage[german=german-x-latest]{hyphsubst} % bessere Silbentrennung
\usepackage{csquotes}


% ---------------------------------------------------------------------------------------------------------------------
% Strukturierung
\renewcaptionname{ngerman}{\partname}{Kapitel}
\renewcaptionname{ngerman}{\chaptername}{Artikel}
\renewcommand*{\chapterformat}{\mbox{\chapapp{\nobreakspace}\thechapter{} -- }}
%\RedeclareSectionCommand[style=section]{chapter}


% ---------------------------------------------------------------------------------------------------------------------
% Tabellen und tabellarische Anordnung
\usepackage{array}                     % hübschere Arrays / Matrizen
\usepackage{longtable}                 % Tabellen über mehrere Seiten
\newcolumntype{L}[1]{>{\raggedright\arraybackslash}p{#1}}
\renewcommand{\arraystretch}{1.4}


% ---------------------------------------------------------------------------------------------------------------------
% Aufzählungen
\usepackage{enumitem}
\setlist[enumerate, 1]{label = (\arabic*)}


% ---------------------------------------------------------------------------------------------------------------------
% Typographie
\usepackage{microtype}
\hbadness=10001
\vbadness=10001


% ---------------------------------------------------------------------------------------------------------------------
% Hyperlinks und Querverweise
\usepackage{qrcode}
\usepackage[  
  colorlinks=true,
  linkcolor=blue,
  urlcolor=teal,
  citecolor=teal,
  bookmarksnumbered=true,
  bookmarksdepth=chapter,
  bookmarksopen=true
]{hyperref}
\def\UrlBreaks{\do\/\do-}% Zeilenumbrüche in langen URLs


% ---------------------------------------------------------------------------------------------------------------------
% Verzeichnisse, Glossar und Abkürzungsverzeichnis
\usepackage{imakeidx}                  % Indexgenerierung + Eintrag in TOC
\setcounter{tocdepth}{0} % only parts and chapters
\RedeclareSectionCommands[tocnumwidth=6ex]{part,chapter}


% ---------------------------------------------------------------------------------------------------------------------
% Literaturverzeichnis
% see https://tex.stackexchange.com/questions/652021/bibliography-with-qr-codes-to-the-right-of-the-entry
\usepackage[style=alphabetic]{biblatex}
\usepackage{biblatex-ext-tabular}
\appto{\biburlsetup}{\renewcommand*{\UrlFont}{\scriptsize\ttfamily}}
\DeclareFieldFormat{qrurl}{\raisebox{\dimeval{-\height+\ht\strutbox}}{\qrcode{#1}}}
\defbibtabular{bibtabular}
  {\setlength{\LTpre}{0pt}%
   \setlength{\LTpost}{0pt}%
   \renewcommand*{\arraystretch}{2}%
   \begin{longtable}{%
   @{}
   L{\labelalphawidth}
   L{\dimexpr0.7\textwidth-0.7\labelalphawidth\relax}
   L{\dimexpr0.3\textwidth-0.3\labelalphawidth\relax}
   @{}}}
  {\end{longtable}}
  {\anchorlang{%
     \printtext[labelalphawidth]{%
       \printfield{labelprefix}%
       \printfield{labelalpha}%
       \printfield{extraalpha}}} &
   \driver{} &
   \plain{\printfield[qrurl]{url}}
    \\}
\addbibresource{DSGVO-ExtendedVersion.bib}

% ---------------------------------------------------------------------------------------------------------------------
% Arbeitshilfen
\usepackage[german]{todonotes}


% ---------------------------------------------------------------------------------------------------------------------
% eigene logische Textauszeichnungen
\newcommand{\comment}[1]{\leavevmode\makenote[paragraphs]{#1}\ignorespaces}
\newenvironment{commentblock}{%
  \begin{addmargin}[0pt]{.333\textwidth}
}{%
  \end{addmargin}
}
\newcommand{\synccomments}{\syncwithnotecolumn[paragraphs]}

